var board=[];for(let e=0;e<101;e++)board.push([]);board[0]=[1,2,3,4];var ladderStarts=[1,4,9,21,28,36,51,71,80],ladderEnds=[38,14,31,42,84,44,67,91,100],chuteStarts=[16,49,62,87,47,56,64,93,95,98],chuteEnds=[6,11,19,24,26,53,60,73,75,78];function roll(){var e=Math.floor(6*Math.random())+1;return 6<e&&(e=6),e}function getPlayerPos(t){for(let e=0;e<board.length;e++)if(board[e].includes(t))return e}function checkForWin(e){if(board[100].includes(e))return!0}function getMove(e){var t=getPlayerPos(e),a=[],r="";board[t].splice(board[t].indexOf(e),1),a.push(t);var n=roll(),r=r+"MOVE: Player ["+getPlayerName(e)+"] rolled a "+n;for(let e=0;e<n;e++)t+=1,a.push(t);ladderStarts.includes(t)?(t=ladderEnds[ladderStarts.indexOf(t)],a.push(t),r=r+"<br>LADDER: Player ["+getPlayerName(e)+"] climbed a ladder to "+t):chuteStarts.includes(t)&&(t=chuteEnds[chuteStarts.indexOf(t)],a.push(t),r=r+"<br>CHUTE: Player ["+getPlayerName(e)+"] fell down a chute to "+t);for(let e=0;e<a.length;e++)100<a[e]&&a.splice(e,1);return 100<t&&(t=100),board[t].push(e),[a,r]}function init_canvas(){var e=document.getElementById("canvas");e.width=501,e.height=501,e.id="canvas",e.getContext("2d").drawImage(document.getElementById("bg"),0,0)}function canvasLocationToNormal(e,t){return[(e-5)/50,(t-5)/50]}function swap(e){return 10-e-1}function getCanvasLocation(e){var t=(e-1)%10,e=Math.floor((e-1)/10);return(e=swap(e))%2==0&&(t=swap(t)),[t=50*t+5,e=50*e+5]}function endGame(){var e=getPlayerPos(1),t=getPlayerPos(2),a=getPlayerPos(3),r=getPlayerPos(4),n={};n[e]="red",n[t]="yellow",n[a]="green",n[r]="blue";e=[e,t,a,r];console.log(e),e.sort(function(e,t){return e-t}),console.log(e);t=n[e[3]],a=n[e[2]],r=n[e[1]],e=n[e[0]];document.getElementById("log_output").innerHTML="GAME OVER<br>Winner: ${winner}<br>Second: ${second}<br>Third: ${third}<br>Fourth: ${fourth}<br><br><br>"+document.getElementById("log_output").innerHTML,console.log("1st: "+t+", 2nd: "+a+", 3rd: "+r+", fourth: "+e)}function wait(t){return new Promise(e=>setTimeout(e,t))}function getPlayerColor(e){return 1==e?"#ff0000":2==e?"#ffff00":3==e?"#00cc00":4==e?"#0033ff":void 0}function getPlayerName(e){return 1==e?"Red":2==e?"Yellow":3==e?"Green":4==e?"Blue":void 0}async function processPlayer(u,d){return new Promise(async function(e){var t=document.getElementById("canvas").getContext("2d");t.fillStyle=getPlayerColor(u);var a=getMove(u),r=a[0],a=a[1];for(let e=0;e<r.length;e++){try{var n=r[e-1];console.log("try")}catch(e){n=getPlayerPos(u);console.log("catch")}var o=r[e];init_canvas();var l=getCanvasLocation(n)[0],i=getCanvasLocation(n)[1],c=getCanvasLocation(o)[0],s=getCanvasLocation(o)[1];t.fillStyle=getPlayerColor(u),t.fillRect(l,i,40,40);for(let e=0;e<Math.ceil(d/45);e++){init_canvas(),t.fillStyle=getPlayerColor(u),t.fillRect(l+e*(c-l)/Math.ceil(d/45),i+e*(s-i)/Math.ceil(d/45),40,40);for(let e=1;e<5;e++)e!=u&&(t.fillStyle=getPlayerColor(e),t.fillRect(getCanvasLocation(getPlayerPos(e))[0],getCanvasLocation(getPlayerPos(e))[1],40,40));await wait(Math.ceil(d/45))}init_canvas(),t.fillStyle=getPlayerColor(u),t.fillRect(c,s,40,40);for(let e=1;e<5;e++)e!=u&&(t.fillStyle=getPlayerColor(e),t.fillRect(getCanvasLocation(getPlayerPos(e))[0],getCanvasLocation(getPlayerPos(e))[1],40,40))}checkForWin(u)?e([!0,a]):e([!1,a])})}async function runRound(i){return new Promise(async function(e,t){init_canvas();var a=document.getElementById("log_output"),r=await processPlayer(1,i);a.innerHTML=r[1]+"<br>"+a.innerHTML,await wait(i);var n=await processPlayer(2,i);a.innerHTML=n[1]+"<br>"+a.innerHTML,await wait(i);var o=await processPlayer(3,i);a.innerHTML=o[1]+"<br>"+a.innerHTML,await wait(i);var l=await processPlayer(4,i);a.innerHTML=l[1]+"<br>"+a.innerHTML,await wait(i),e([r[0],n[0],o[0],l[0]])})}async function main(){var e=await runRound(document.getElementById("speed").value),t=e[0],a=e[1],r=e[2],e=e[3];(t||a||r||e?endGame:main)()}
